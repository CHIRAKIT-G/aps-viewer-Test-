<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>APS Viewer – ACC style</title>

    <link rel="stylesheet"
          href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.min.css" />
    <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.min.js"></script>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: sans-serif;
      }
      #viewer {
        width: 100%;
        height: 100%;
      }
      #debug {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(255,255,255,0.9);
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="viewer"></div>
    <div id="debug">กำลังโหลด APS Viewer … ถ้าเห็นกล่องนี้นานผิดปกติ แสดงว่า JS มีปัญหา ให้เปิด F12 ดู Console</div>

    <script>
      // ====== ใส่ URN ของคุณ ======
      var urn = "dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLk9ZbHM4RW9JUTRHNnZUcHdxbElTMXc_dmVyc2lvbj00";

      // ====== ใส่ access_token ใหม่ล่าสุดตรงนี้ (จาก Postman) ======
      function getAccessToken(onTokenReady) {
        var token = "eyJhbGciOiJSUzI1NiIsImtpZCI6IlZiakZvUzhQU3lYODQyMV95dndvRUdRdFJEa19SUzI1NiIsInBpLmF0bSI6ImFzc2MifQ.eyJzY29wZSI6WyJkYXRhOnJlYWQiXSwiY2xpZW50X2lkIjoiNUNRSUhtWXZYY0tQYlZQcGtFOGJLM21MeUpIejZndXhENHJqSUc4Q3h1bWdIekdtIiwiaXNzIjoiaHR0cHM6Ly9kZXZlbG9wZXIuYXBpLmF1dG9kZXNrLmNvbSIsImF1ZCI6Imh0dHBzOi8vYXV0b2Rlc2suY29tIiwianRpIjoiV25lajBZcXRFNUJNZWUyb0Q4UlpnUjJPUTdLSXJ3Vk00eDBRNFI5ZzZXdkI5b3BJRUZDRm96VlVGdVFBeG9TYyIsImV4cCI6MTc2MzQ1OTg2M30.Tz1xzxj1vxzrbLa40_lBdtTq6RGCSeeYhO28DLTzP8WDe2V6wIlfBx8jLo7a2TpR6wrFsU5eeKB9h5rNMeWQNx8l7y9UzCP9PebarAGOKA-45-U5y1MHfUKC_j62uf1QnmFAVjPYyh-n5id2n7SfdKBzJJTfn4PRwHMiIhnRl8NAK2U4wgO36msXe5ioc9E7id3XwTF9H-D8F9h_RpbJwITNSPcqYwojq5QgyRfUv0j7ZAhs2jR8XQsZVIk0y8DnDnNwprEVmkdiCO_g8uFgOaMo9NiAFjSvhWcIYXPtykJfH8yxYG4JC_FozMtkNLIZSSlsGKfGvERmU16T3N3RSg";
        var expiresIn = 3500;
        onTokenReady(token, expiresIn);
      }

      var options = {
        env: "AutodeskProduction",
        getAccessToken: getAccessToken
      };

      Autodesk.Viewing.Initializer(options, function () {

        var config3d = {
          extensions: [
            "Autodesk.ViewCubeUi",
            "Autodesk.DocumentBrowser",
            "Autodesk.Section",
            "Autodesk.Measure",
            "Autodesk.Explode",
            "Autodesk.BimWalk"
          ]
        };

        var viewerDiv = document.getElementById("viewer");
        var viewer = new Autodesk.Viewing.GuiViewer3D(viewerDiv, config3d);
        var startedCode = viewer.start();

        if (startedCode > 0) {
          console.error("Viewer failed to start: " + startedCode);
          document.getElementById("debug").innerText = "Viewer start ไม่สำเร็จ ดู error ใน Console (F12)";
          return;
        }

        document.getElementById("debug").style.display = "none";
        viewer.setTheme("light-theme");
        viewer.setActiveNavigationTool("orbit");

        var documentId = "urn:" + urn;
        Autodesk.Viewing.Document.load(
          documentId,
          function (doc) {
            var defaultModel = doc.getRoot().getDefaultGeometry();
            viewer.loadDocumentNode(doc, defaultModel);
          },
          function (errCode, errMsg) {
            console.error("Document load failed:", errCode, errMsg);
            document.getElementById("debug").innerText =
              "โหลดโมเดลไม่สำเร็จ ดู error ใน Console (F12) – token อาจหมดอายุ";
          }
        );
      });
    </script>
  </body>
</html>

